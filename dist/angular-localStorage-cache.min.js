var SpeedShifter;!function(a){!function(b){b.LocalStorageProvider=function(){var b=this,c=this,d=".",e="\\.",f=3e5;b.name="ngLocalStorage",b.defOptions={},this.$get=["$log","$window","$interval","$timeout",function(c,g,h,i){var j="undefined"==typeof g.localStorage?void 0:g.localStorage,k=!("undefined"==typeof j||"undefined"==typeof JSON),l={get:function(a){if(!k)return null;var b=j.getItem(a);try{var c=JSON.parse(b);return"undefined"==typeof c&&(c=b),"true"===c?c=!0:"false"===c&&(c=!1),c}catch(d){return b}},set:function(a,b){if(!k)return null;try{j.setItem(a,JSON.stringify(b))}catch(d){throw c.error("localStorage LIMIT REACHED: ("+d+")"),d}return b},remove:function(a){return k?(j.removeItem(a),!0):!1}},m={cacheStack:{}},n=new a.Services.DepStorage;return m.getCacheObject=function(a){return m.cacheStack[a]&&m.cacheStack[a].cache||null},m.registerCacheObject=function(a,b,c){return m.getCacheObject(a)?m.getCacheObject(a):(m.cacheStack[a]={cache:b,private_cache:c},m.cacheStack[a].cache)},m.unregisterCacheObject=function(a){delete m.cacheStack[a]},m.cleanStorage=function(a){if(k){if(angular.isDefined(a)&&angular.isNumber(a))return i.cancel(m.cleanTimeout),m.cleanTimeout=i(m.cleanStorage,a),0;var b,c,d,e=m.cacheStack,f=0,g=(new Date).getTime();for(b=0;b<j.length;b++){c=j.key(b);for(d in e)try{if(e[d].private_cache.isInvalid(c,g)){l.remove(c),b--,f++;break}}catch(h){}}return m.resetCleanInterval(),f}},m.cleanOnStorageOverflow=function(a){if(k){var b=m.cleanStorage();if(a&&a>b){var c,d,e,f=m.cacheStack;for(c=0;c<j.length;c++){d=j.key(c);for(e in f)try{if(f[e].private_cache.isCritical(d)){l.remove(d),c--,b++;break}}catch(g){}if(a&&b>=a)break}}return b}},m.clearStorage=function(){if(k){var a,b,c,d=m.cacheStack,e=0;for(a=0;a<j.length;a++){b=j.key(a);for(c in d)try{if(d[c].private_cache.isBelongs(b)){l.remove(b),a--,e++;break}}catch(f){}}return e}},m.setCleanInterval=function(a){"undefined"==typeof a&&(a=f),m.cleanIntervalTime=a,h.cancel(m.cleanInterval),m.cleanInterval=h(m.cleanStorage,a)},m.resetCleanInterval=function(){m.setCleanInterval(m.cleanIntervalTime);for(var a in m.cacheStack)m.cacheStack[a].private_cache.resetCleanInterval()},m.setCleanInterval(b.defOptions.cleanTimeout),m.cleanStorage(1e4),k||c.error("LocalStorage is not supported"),function(g,o){var p=b.name+d+g;if(m.getCacheObject(p))return c.log(g+" localStorage already exists."),m.getCacheObject(p);var q,r={},s=new a.Services.DepStorage(n),t={},u=new RegExp("^"+p+e+".*","i"),v=new a.Services.DepChecker(o,s);return r.setOptions=function(a){q=angular.extend({},b.defOptions,a),v.setOptions(q)},r.setOptions(o),r.getLocalStorageKey=function(a){return p+d+(a||"")},r.get=function(a){var b=r.getLocalStorageKey(a),c=l.get(b);return c?v.isItemInvalid(l.get(b))?(l.remove(b),null):c.data:null},r.set=function(b,d){var e=r.getLocalStorageKey(b),f={data:d,time:a.Services.ExpirationChecker.now(),depends:s.composeDeps(q.dependent)};try{l.set(e,f)}catch(g){c.log("localStorage LIMIT REACHED: ("+g+")"),i(m.cleanOnStorageOverflow,0)}},r.remove=function(a){var b=r.getLocalStorageKey(a);l.remove(b)},r.clear=function(){if(k){var a,b;for(a=0;a<j.length;a++)b=j.key(a),t.isBelongs(b)&&(l.remove(b),a--)}},r.clearStorage=function(){m.clearStorage()},r.setDependence=function(a,b){b?(n.setDependence(a),m.cleanStorage(5e3)):(s.setDependence(a),t.cleanStorage(5e3))},r.removeDependence=function(a,b){b?(n.removeDependence(a),m.cleanStorage(1e4)):(s.removeDependence(a),t.cleanStorage(1e4))},r.setDependenceVal=function(a,b,c){c?(n.setDependenceVal(a,b),m.cleanStorage(5e3)):(s.setDependenceVal(a,b),t.cleanStorage(5e3))},t.cleanStorage=function(a){if(k){if(angular.isDefined(a)&&angular.isNumber(a))return i.cancel(t.cleanTimeout),t.cleanTimeout=i(t.cleanStorage,a),0;var b,c,d=0,e=(new Date).getTime();for(b=0;b<j.length;b++)c=j.key(b),t.isInvalid(c,e)&&(l.remove(c),b--);return t.resetCleanInterval(),d}},t.isBelongs=function(a){return u.test(a)},t.isInvalid=function(a,b){return t.isBelongs(a)?v.isItemInvalid(l.get(a),b):!1},t.isCritical=function(a){return t.isBelongs(a)&&q.critical},t.setCleanInterval=function(a){"undefined"==typeof a&&(a=f),t.cleanIntervalTime=a,h.cancel(t.cleanInterval),t.cleanInterval=h(t.cleanStorage,a)},t.resetCleanInterval=function(){t.setCleanInterval(t.cleanIntervalTime)},t.setCleanInterval(q.cleanTimeout),m.registerCacheObject(p,r,t),r}}],c.setAppName=function(a){b.name=a},c.setDefOptions=function(a){b.defOptions=angular.extend({},b.defOptions,a)}};var c=angular.module("speedshifter.localStoragePromise",[]);c.provider("localStoragePromise",b.LocalStorageProvider)}(a.Services||(a.Services={}));a.Services}(SpeedShifter||(SpeedShifter={}));