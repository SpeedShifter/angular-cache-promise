var SpeedShifter;!function(a){!function(a){var b=function(){function a(){}return a.compare=function(a,b){return a&&(a.comparator&&a.comparator(a.value,b)||a.value===b||angular.isObject(a.value)&&angular.equals(a.value,b))},a.getDepend=function(a,b){for(var c=0;b&&c<b.length;c++)if(b[c][a])return b[c][a];return null},a.isDependentFailed=function(b,c,d){if(!b)return!0;var e,f;if(c&&c.length>0)for(e=0;e<c.length;e++)if(f=a.getDepend(c[e],d),!f||angular.isUndefined(b[c[e]])||f&&!a.compare(f,b[c[e]]))return!0;return!1},a.isItemOutdated=function(a,b,c){return"undefined"==typeof c&&(c=(new Date).getTime()),a&&!b?!1:a&&b&&(!b.expires||angular.isDefined(a.time)&&c-a.time<b.expires)?!1:!0},a.isItemInvalid=function(b,c,d,e){return"undefined"==typeof e&&(e=(new Date).getTime()),b&&!c?!1:!b||!c||!d||a.isItemOutdated(b,c,e)||c.dependent&&a.isDependentFailed(b.depends,c.dependent,d)?!0:!1},a.composeDeps=function(b,c){if(b&&b.length>0){var d,e,f={},g=0;for(d=0;d<b.length;d++)e=a.getDepend(b[d],c),e&&(f[b[d]]=e.value,g++);if(g>0)return f}return null},a}();a.LocalStorageHelpers=b,a.LocalStorageProvider=function(){var a=this,c=this,d=".",e="\\.",f=3e5;a.name="ngLocalStorage",a.defOptions={},this.$get=["$log","$window","$interval","$timeout",function(c,g,h,i){var j="undefined"==typeof g.localStorage?void 0:g.localStorage,k=!("undefined"==typeof j||"undefined"==typeof JSON),l={get:function(a){if(!k)return null;var b=j.getItem(a);try{var c=JSON.parse(b);return"undefined"==typeof c&&(c=b),"true"===c?c=!0:"false"===c&&(c=!1),c}catch(d){return b}},set:function(a,b){if(!k)return null;try{j.setItem(a,JSON.stringify(b))}catch(d){throw c.error("localStorage LIMIT REACHED: ("+d+")"),d}return b},remove:function(a){return k?(j.removeItem(a),!0):!1}},m={cacheStack:{}},n={};return m.getCacheObject=function(a){return m.cacheStack[a]&&m.cacheStack[a].cache||null},m.registerCacheObject=function(a,b,c){return m.getCacheObject(a)?m.getCacheObject(a):(m.cacheStack[a]={cache:b,private_cache:c},m.cacheStack[a].cache)},m.unregisterCacheObject=function(a){delete m.cacheStack[a]},m.cleanStorage=function(a){if(k){if(angular.isDefined(a)&&angular.isNumber(a))return void i(m.cleanStorage,a);var b,c,d,e=m.cacheStack,f=0,g=(new Date).getTime();for(b=0;b<j.length;b++){c=j.key(b);for(d in e)try{if(e[d].private_cache.isInvalid(c,g)){l.remove(c),b--,f++;break}}catch(h){}}return f}},m.cleanOnStorageOverflow=function(a){if(k){var b=m.cleanStorage();if(a&&a>b){var c,d,e,f=m.cacheStack,b=0;for(c=0;c<j.length;c++){d=j.key(c);for(e in f)try{if(f[e].private_cache.isCritical(d)){l.remove(d),c--,b++;break}}catch(g){}if(a&&b>=a)break}}return b}},m.clearStorage=function(){if(k){var a,b,c,d=m.cacheStack,e=0;for(a=0;a<j.length;a++){b=j.key(a);for(c in d)try{if(d[c].private_cache.isBelongs(b)){l.remove(b),a--,e++;break}}catch(f){}}return e}},m.setClearInterval=function(a){"undefined"==typeof a&&(a=f),h.cancel(m.clearInterval),m.clearInterval=h(m.cleanStorage,a)},m.setClearInterval(a.defOptions.cleanTimeout),m.cleanStorage(1e4),k||c.error("LocalStorage is not supported"),function(g,o){var p=a.name+d+g;if(m.getCacheObject(p))return c.log(g+" localStorage already exists."),m.getCacheObject(p);var q,r={},s={},t=[s,n],u={},v=new RegExp("^"+p+e+".*","i");return r.setOptions=function(b){q=angular.extend({},a.defOptions,b)},r.setOptions(o),r.getLocalStorageKey=function(a){return p+d+(a||"")},r.get=function(a){var c=r.getLocalStorageKey(a),d=l.get(c);return d?b.isItemInvalid(l.get(c),q,t)?(l.remove(c),null):d.data:null},r.set=function(a,d){var e=r.getLocalStorageKey(a),f={data:d,time:(new Date).getTime(),depends:b.composeDeps(q.dependent,t)};try{l.set(e,f)}catch(g){c.log("localStorage LIMIT REACHED: ("+g+")"),i(m.cleanOnStorageOverflow,0)}},r.remove=function(a){var b=r.getLocalStorageKey(a);l.remove(b)},r.clear=function(){if(k){var a,b;for(a=0;a<j.length;a++)b=j.key(a),u.isBelongs(b)&&(l.remove(b),a--)}},r.clearStorage=function(){m.clearStorage()},r.setDependence=function(a,b){b?(n[a.name]=a,m.cleanStorage(5e3)):(s[a.name]=a,u.cleanStorage(5e3))},r.removeDependence=function(a,b){b?(delete n[a],m.cleanStorage(1e4)):(delete s[a],u.cleanStorage(1e4))},r.setDependenceVal=function(a,b,c){c?(n[a]?n[a].value=b:n[a]={name:a,value:b},m.cleanStorage(5e3)):(s[a]?s[a].value=b:s[a]={name:a,value:b},u.cleanStorage(5e3))},u.cleanStorage=function(a){if(k){if(angular.isDefined(a)&&angular.isNumber(a))return void i(u.cleanStorage,a);var b,c,d=0,e=(new Date).getTime();for(b=0;b<j.length;b++)c=j.key(b),u.isInvalid(c,e)&&(l.remove(c),b--);return d}},u.isBelongs=function(a){return v.test(a)},u.isInvalid=function(a,c){return"undefined"==typeof c&&(c=(new Date).getTime()),u.isBelongs(a)?b.isItemInvalid(l.get(a),q,t,c):!1},u.isCritical=function(a){return u.isBelongs(a)&&q.critical},u.setClearInterval=function(b){"undefined"==typeof b&&(b=f),h.cancel(u.clearInterval),b!=a.defOptions.cleanTimeout&&(u.clearInterval=h(u.cleanStorage,b))},u.setClearInterval(q.cleanTimeout),m.registerCacheObject(p,r,u),r}}],c.setAppName=function(b){a.name=b},c.setDefOptions=function(b){a.defOptions=angular.extend({},a.defOptions,b)}};var c=angular.module("speedshifter.localStoragePromise",[]);c.provider("localStoragePromise",a.LocalStorageProvider)}(a.Services||(a.Services={}));a.Services}(SpeedShifter||(SpeedShifter={}));